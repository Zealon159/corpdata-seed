<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<title>组织管理</title>
		<div th:replace="common/common_grid_header"></div>
	</head>
	<body>
		<div style="padding: 15px; height: 100%">
			<div class="layui-row">
				<div class="search-box flex-between">
					<div class="my-search-box" id="my-search-box">
					    <input class="form-control" id="keyword" placeholder="关键字" type="text" width="100px" />
					    <i class="glyphicon glyphicon-search my-search-icon"></i>
				    </div>
				    <button class="layui-btn layui-btn-sm layui-btn-primary"  id="add-disc">
				      <i class="layui-icon">&#xe61f;</i>新增
				    </button>
				</div>
				
				<table class="layui-hide" id="LAY_table_dept" lay-filter="dept"></table> 
			</div>
		</div>
		
		<script type="text/html" id="toolBar">
  			<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
  			<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
		</script>
		<script>
			layui.use('table', function(){
				var table = layui.table;
			  	
				//方法级渲染
				table.render({
					id:'dg_dept',
				    elem: '#LAY_table_dept',
				    url: '/orgdept/listdata',
				    method:'post',
				    cols: [[
				      //{checkbox: true, fixed: true},
				      {field:'foldername', title: '组织名称'}
				      ,{field:'folderid', title: '层级编号',  sort: true}
				      ,{field:'sortNumber', title: '排序'}
				      ,{fixed: 'right', width:178, align:'center', toolbar: '#toolBar'}
				      
				    ]]
				    ,page: true
				    ,height: 450
				});
				
				//监听工具条
				table.on('tool(dept)', function(obj){
				    var data = obj.data;
				    if(obj.event == 'detail'){
				      layer.msg('ID：'+ data.id + ' 的查看操作');
				    } else if(obj.event == 'del'){
				      	layer.confirm('真的删除数据吗？', function(index){
				        	//发送删除请求
				        	$.post("/orgdept/delete",{id:data.id},function(res){
				        		obj.del();
					        	layer.close(index);
					        	layer.msg(res.msg);
				            },"json");
				      	});
				    } else if(obj.event == 'edit'){
				    	layer.open({
							title : [ '组织信息',
									'font-size:18px;text-align:center;padding:0' ],
							type : 2,
							area : [ '600px', '316px' ],
							shade : [ 0.8, '#393D49' ],
							content : [ "/orgdept/edit/"+data.id, 'no' ]
						});
				    }
				});
				  
				$('.demoTable .layui-btn').on('click', function(){
				    var type = $(this).data('type');
				    active[type] ? active[type].call(this) : '';
				});
			});
			
			
			$(function() {
				layui.use([ 'element', 'table', 'layer' ], function() {
					var element = layui.element;
				});
				
				//弹出框
				$("#add-disc").on("click",function() {
					layer.open({
						title : [ '组织信息',
								'font-size:18px;text-align:center;padding:0' ],
						type : 2,
						area : [ '600px', '316px' ],
						shade : [ 0.8, '#393D49' ],
						content : [ "/orgdept/add", 'no' ]
					});
				})
				
				//查询
				$("#keyword").keyup(function (event) {
			        var e = event|| window.event;
			        if (e.keyCode == "13") {
			        	var keyword = $('#keyword').val();
			        	layui.table.reload('dg_dept', {
					        page: {
					          curr: 1 //重新从第 1 页开始
					        }
					        ,where: {
					        	keyword: keyword
					        }
					    });
			        }
			    });
			})
			
		</script>
	</body>
</html>